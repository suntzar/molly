<!doctype html>
<html lang="pt-br" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Galeria de Mídia Noxss</title>
    <script defer src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="noxss/dist/noxss.css" />
    <style>
        :root {
            --noxss-accent-primary: #e677b4; --noxss-accent-primary-hover: #ff85c6; --noxss-accent-primary-rgb: 230, 119, 180; --noxss-color-danger: #e67777;
        }
        .noxss-desktop-nav { display: none; }
        .noxss-mobile-nav { display: flex; }
        @media (min-width: 992px) { .noxss-desktop-nav { display: flex; } .noxss-mobile-nav { display: none; } }

        .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; padding: 1rem; }
        .media-list { display: flex; flex-direction: column; gap: 0.5rem; padding: 1rem; }
        
        .noxss-card .card-video-thumb {
            width: 100%; height: 100%; object-fit: cover; pointer-events: none; border-radius: var(--noxss-border-radius-base);
        }
        .noxss-card--video .noxss-card__body { display: none; }

        .noxss-modal__body--fullscreen { display: flex; align-items: center; justify-content: center; padding: 0; background-color: var(--noxss-bg-main); }
        #fullscreen-photo, #modal-video-player { max-width: 100%; max-height: 100%; object-fit: contain; }
        #modal-video-player { width: 100%; height: auto; max-height: 75vh; border-radius: var(--noxss-border-radius-base); background-color: #000; }
        .noxss-modal__header--fullscreen { position: absolute; top: 0; left: 0; width: 100%; background: linear-gradient(to bottom, rgba(0, 0, 0, 0.6), transparent); border-bottom: none; }
        .modal-actions { margin-left: auto; display: flex; gap: 0.5rem; }
        .noxss-btn .feather.is-favorite { fill: var(--noxss-color-danger); color: var(--noxss-color-danger); }
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: calc(100% - 2rem); text-align: center; color: var(--noxss-text-secondary); padding: 1rem; }
        .empty-state .noxss-icon { width: 4rem; height: 4rem; margin-bottom: 1rem; stroke-width: 1; }
        .empty-state .noxss-form-group { width: 100%; max-width: 450px; margin-top: 1rem; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 1rem 0.5rem; border-bottom: 1px solid var(--noxss-border-color); }
        .panel-header h4 { margin: 0; border: none; padding: 0; }
        @keyframes skeleton-loading { 0% { background-color: var(--noxss-bg-elements); } 50% { background-color: var(--noxss-border-color); } 100% { background-color: var(--noxss-bg-elements); } }
        .skeleton-card { animation: skeleton-loading 1.5s infinite ease-in-out; background-color: var(--noxss-bg-elements); border-radius: var(--noxss-border-radius-base); aspect-ratio: 1 / 1; }
    </style>
</head>
<body data-noxss-layout="app">
    <div class="noxss-layout">
        <nav class="noxss-navbar">
            <a class="noxss-navbar__brand" href="#"><i data-feather="film" class="noxss-icon"></i> <span>Mídia Noxss</span></a>
        </nav>
        <main class="noxss-layout__content">
            <div class="noxss-tabs" data-default-tab="all">
                <div class="noxss-tabs__header noxss-desktop-nav">
                    <button class="noxss-tabs__header-button" data-tab-id="all"><i data-feather="globe" class="noxss-icon"></i> Feed Geral</button>
                    <button class="noxss-tabs__header-button" data-tab-id="photos"><i data-feather="image" class="noxss-icon"></i> Fotos</button>
                    <button class="noxss-tabs__header-button" data-tab-id="videos"><i data-feather="video" class="noxss-icon"></i> Vídeos</button>
                    <button class="noxss-tabs__header-button" data-tab-id="favorites"><i data-feather="heart" class="noxss-icon"></i> Favoritos</button>
                    <button class="noxss-tabs__header-button" data-tab-id="search"><i data-feather="search" class="noxss-icon"></i> Buscar</button>
                    <button class="noxss-tabs__header-button" data-tab-id="settings"><i data-feather="settings" class="noxss-icon"></i> Ajustes</button>
                </div>
                <div class="noxss-tabs__content-area">
                    <section class="noxss-tabs__panel" id="panel-all"></section>
                    <section class="noxss-tabs__panel" id="panel-photos"></section>
                    <section class="noxss-tabs__panel" id="panel-videos"></section>
                    <section class="noxss-tabs__panel" id="panel-favorites"></section>
                    <section class="noxss-tabs__panel" id="panel-search"></section>
                    <section class="noxss-tabs__panel" id="panel-settings"></section>
                </div>
            </div>
        </main>
        <nav class="noxss-navbar noxss-navbar--bottom noxss-mobile-nav">
            <button class="noxss-tabs__nav-button" data-tab-id="all"><i data-feather="globe" class="noxss-icon"></i></button>
            <button class="noxss-tabs__nav-button" data-tab-id="photos"><i data-feather="image" class="noxss-icon"></i></button>
            <button class="noxss-tabs__nav-button" data-tab-id="videos"><i data-feather="video" class="noxss-icon"></i></button>
            <button class="noxss-tabs__nav-button" data-tab-id="favorites"><i data-feather="heart" class="noxss-icon"></i></button>
            <button class="noxss-tabs__nav-button" data-tab-id="search"><i data-feather="search" class="noxss-icon"></i></button>
        </nav>
    </div>

    <div class="noxss-modal noxss-modal--fullscreen" id="photo-modal" data-noxss-modal><div class="noxss-modal__dialog"><div class="noxss-modal__header noxss-modal__header--fullscreen"><h3 class="noxss-modal__title" id="photo-modal-title"></h3><div class="modal-actions"><button class="noxss-btn noxss-btn--icon" id="favorite-photo-btn" title="Favoritar"><i data-feather="heart" class="noxss-icon"></i></button><a href="#" class="noxss-btn noxss-btn--icon" id="download-photo-btn" download title="Baixar"><i data-feather="download" class="noxss-icon"></i></a><button class="noxss-btn noxss-btn--icon" id="fullscreen-btn" title="Tela Cheia"><i data-feather="maximize" class="noxss-icon"></i></button><button class="noxss-btn noxss-btn--icon" data-noxss-modal-close title="Fechar"><i data-feather="x" class="noxss-icon"></i></button></div></div><div class="noxss-modal__body noxss-modal__body--fullscreen"><img src="" alt="" id="fullscreen-photo" /></div></div></div>
    <div class="noxss-modal" id="video-modal" data-noxss-modal><div class="noxss-modal__dialog"><div class="noxss-modal__header"><h3 class="noxss-modal__title" id="video-modal-title"></h3><button class="noxss-btn noxss-btn--icon" data-noxss-modal-close><i data-feather="x" class="noxss-icon"></i></button></div><div class="noxss-modal__body"><video src="" id="modal-video-player" controls autoplay></video></div><div class="noxss-modal__footer"><a href="#" class="noxss-btn noxss-btn--secondary" id="download-video-btn" download><i data-feather="download" class="noxss-icon"></i> Baixar</a><button class="noxss-btn noxss-btn--primary" id="favorite-video-btn"><i data-feather="heart" class="noxss-icon"></i> Favoritar</button></div></div></div>

    <script src="noxss/js/core.js"></script><script src="noxss/js/components/tabs.js"></script><script src="noxss/js/components/modals.js"></script><script src="noxss/js/components/toasts.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const state = { media: [], favorites: new Set(JSON.parse(localStorage.getItem("mediaFavorites_v3")) || []), layout: localStorage.getItem("mediaLayout") || "grid", theme: localStorage.getItem("appTheme_v3") || "dark" };
            const ui = {
                containers: { all: document.getElementById('panel-all'), photos: document.getElementById('panel-photos'), videos: document.getElementById('panel-videos'), favorites: document.getElementById('panel-favorites'), search: document.getElementById('panel-search'), settings: document.getElementById('panel-settings') },
                photoModal: { img: document.getElementById('fullscreen-photo'), title: document.getElementById('photo-modal-title'), downloadBtn: document.getElementById('download-photo-btn'), favoriteBtn: document.getElementById('favorite-photo-btn'), fullscreenBtn: document.getElementById('fullscreen-btn') },
                videoModal: { video: document.getElementById('modal-video-player'), title: document.getElementById('video-modal-title'), favoriteBtn: document.getElementById('favorite-video-btn'), downloadBtn: document.getElementById('download-video-btn') },
            };

            const normalizeMediaData = data => Array.isArray(data) ? data.map(item => ({ type: item.type || 'photo', description: 'N/A', date: 'N/A', title: 'N/A', ...item })) : [];
            
            const renderers = {
                grid: {
                    photo: p => `<div class="noxss-card noxss-card--media-top noxss-card--interactive" data-filename="${p.filename}" data-type="photo"><img src="fotos/${p.filename}" class="noxss-card__media" loading="lazy"></div>`,
                    video: v => `<div class="noxss-card noxss-card--interactive" data-filename="${v.filename}" data-type="video"><video class="card-video-thumb" src="videos/${v.filename}#t=0.5" preload="metadata" muted></video></div>`
                },
                list: {
                    photo: p => `<div class="noxss-list-item noxss-list-item--interactive" data-filename="${p.filename}" data-type="photo"><div class="noxss-list-item__leading"><img src="fotos/${p.filename}" class="noxss-list-item__avatar" loading="lazy"></div><div class="noxss-list-item__content"><div class="noxss-list-item__title">${p.filename}</div><div class="noxss-list-item__subtitle">${p.description}</div></div><div class="noxss-list-item__trailing"><small>${p.date}</small></div></div>`,
                    video: v => `<div class="noxss-list-item noxss-list-item--interactive" data-filename="${v.filename}" data-type="video"><div class="noxss-list-item__leading"><i class="noxss-icon noxss-list-item__icon" data-feather="video"></i></div><div class="noxss-list-item__content"><div class="noxss-list-item__title">${v.title}</div><div class="noxss-list-item__subtitle">${v.duration}</div></div><div class="noxss-list-item__trailing"><small>${v.date}</small></div></div>`
                }
            };
            
            const renderContainer = (container, mediaList, layout, empty) => {
                if (!container) return;
                const toggleHTML = `<div class="layout-toggle"><button class="noxss-btn noxss-btn--icon ${layout === 'grid' ? 'active' : ''}" data-layout="grid" title="Grade"><i class="noxss-icon" data-feather="grid"></i></button><button class="noxss-btn noxss-btn--icon ${layout === 'list' ? 'active' : ''}" data-layout="list" title="Lista"><i class="noxss-icon" data-feather="list"></i></button></div>`;
                container.innerHTML = `<div class="panel-header"><h4>${empty.title}</h4>${toggleHTML}</div>`;
                if (mediaList.length === 0) {
                    container.innerHTML += `<div class="empty-state"><i class="noxss-icon" data-feather="${empty.icon}"></i><p>${empty.message}</p></div>`;
                } else {
                    const renderFn = layout === 'list' ? renderers.list : renderers.grid;
                    container.innerHTML += `<div class="${layout === 'list' ? 'media-list' : 'media-grid'}">${mediaList.map(item => renderFn[item.type] ? renderFn[item.type](item) : '').join("")}</div>`;
                }
            };

            const renderSearchPanel = () => { /* ... (mesma função da versão anterior) ... */ };
            const renderSettingsPanel = () => { /* ... (mesma função da versão anterior) ... */ };
            
            const renderAll = () => {
                const { media, favorites, layout } = state;
                renderContainer(ui.containers.all, media, layout, { title: "Feed Geral", message: "Nenhuma mídia encontrada.", icon: "slash" });
                renderContainer(ui.containers.photos, media.filter(m => m.type === 'photo'), layout, { title: "Apenas Fotos", message: "Nenhuma foto encontrada.", icon: "camera-off" });
                renderContainer(ui.containers.videos, media.filter(m => m.type === 'video'), layout, { title: "Apenas Vídeos", message: "Nenhum vídeo encontrado.", icon: "video-off" });
                renderContainer(ui.containers.favorites, media.filter(m => favorites.has(m.filename)), layout, { title: "Meus Favoritos", message: "Você ainda não favoritou nada.", icon: "heart" });
                feather.replace();
            };
            
            const openMediaModal = (filename, type) => {
                const mediaItem = state.media.find(m => m.filename === filename);
                if (!mediaItem) return;
                const isFav = state.favorites.has(filename);

                if (type === 'photo') {
                    ui.photoModal.img.src = `fotos/${filename}`; ui.photoModal.title.textContent = `${filename} - ${mediaItem.date}`; ui.photoModal.downloadBtn.href = `fotos/${filename}`;
                    ui.photoModal.favoriteBtn.dataset.filename = filename;
                    ui.photoModal.favoriteBtn.querySelector('.feather').classList.toggle('is-favorite', isFav);
                    Noxss.Modals.open("photo-modal");
                } else {
                    ui.videoModal.video.src = `videos/${filename}`; ui.videoModal.title.textContent = `${mediaItem.title}`;
                    ui.videoModal.favoriteBtn.dataset.filename = filename;
                    ui.videoModal.favoriteBtn.querySelector('.feather').classList.toggle('is-favorite', isFav);
                    ui.videoModal.downloadBtn.href = mediaItem.downloadable ? `videos/${filename}` : '#';
                    ui.videoModal.downloadBtn.style.display = mediaItem.downloadable ? 'inline-flex' : 'none';
                    Noxss.Modals.open("video-modal");
                }
                feather.replace();
            };

            const toggleFavorite = (filename) => { /* ... (mesma função da versão anterior) ... */ };

            const init = async () => {
                const skeletonHTML = `<div class="media-grid">${Array(12).fill('<div class="skeleton-card"></div>').join('')}</div>`;
                Object.values(ui.containers).forEach(c => { if(c) c.innerHTML = skeletonHTML; });
                
                try {
                    const response = await fetch('midia.json');
                    if (!response.ok) throw new Error('Falha ao buscar midia.json');
                    const rawData = await response.json();
                    state.media = normalizeMediaData(rawData);
                } catch (error) {
                    console.error("Erro ao carregar dados:", error);
                    // Opcional: Adicionar UI de erro aqui, como a de fallback de JSON
                } finally {
                    renderAll();
                    renderSearchPanel();
                    renderSettingsPanel();
                }
            };
            
            // --- EVENT LISTENERS ---
            document.body.addEventListener('click', (e) => {
                const item = e.target.closest('[data-filename]');
                if (item) openMediaModal(item.dataset.filename, item.dataset.type);

                const layoutBtn = e.target.closest('.layout-toggle .noxss-btn[data-layout]');
                if(layoutBtn) {
                    state.layout = layoutBtn.dataset.layout;
                    localStorage.setItem("mediaLayout", state.layout);
                    renderAll();
                }
            });

            [ui.photoModal.favoriteBtn, ui.videoModal.favoriteBtn].forEach(btn => btn.addEventListener('click', (e) => toggleFavorite(e.currentTarget.dataset.filename)));
            ui.photoModal.fullscreenBtn.addEventListener('click', () => ui.photoModal.img.requestFullscreen().catch(err => Noxss.Toasts.show({message: "Modo tela cheia não suportado.", status: "warning"})));
            
            document.documentElement.dataset.theme = state.theme;
            init();
        });
    </script>
</body>
</html>